- title "Rechercher des dossiers"

- content_for :main do
  %h2 Filtrer
  - form_for @search, :class => "search" do |f|
    %ol.formList
      %li
        = f.label "Par date"
        = f.calendar_date_select :date_appel_after, :year_range => 1995..Time.now.year, :valid_date_check => "date < (new Date()).stripTime()", :popup => :force, :size => 8
        = " - "
        = f.calendar_date_select :date_appel_before, :year_range => 1995..Time.now.year, :popup => :force, :size => 8
      %li
        = f.label "Nom patiente"
        = f.text_field :nom_like
      %li
        = f.label "Mot(s) dans les commentaires"
        = f.text_field :commentaire_like
      %li
        = f.label "Profession"
        = f.collection_select :profession_id_equals, Profession.all, :id, :name, :include_blank => true
      %li
        = f.label "Correspondant (spécialité)"
        = f.collection_select :correspondant_specialite_id_equals, Specialite.all, :id, :name, :include_blank => true
      %li
        = f.label "Produits"
        = f.collection_select :produits_id_equals, Produit.all(:order => "LOWER(name) ASC"), :id, :name, :include_blank => true
      %li
        = f.label "Type Exposition"
        = f.select :expo_type_equals, %w[solvants autres], {:include_blank => true}
      %li
        = f.label "Niveau"
        = f.collection_select :niveau_id_equals, Niveau.all, :id, :name, :include_blank => true
      %li
        = f.label "Evolution"
        = f.collection_select :acctype_id_equals, Acctype.all, :id, :name, :include_blank => true
      %li
        = f.label "Malformation"
        = f.check_box :is_malforme
      %li
        = f.submit "OK", :name => nil

  %hr

  - if @dossiers.count > 0
    %a{:name => "results"}
    - unless params[:search].blank?
      %h4="Résultats : " + h(@dossiers.count.to_s)
      %table#dossiers.collapse
        %tr
          %th= order @search, :by => :date_appel, :as => 'Année'
          %th= order @search, :by => :n_sicap, :as => 'Dossier'
          %th= order @search, :by => :nom, :as => 'Patiente'
          %th= order @search, :by => :age, :as => 'Âge'
          %th= order @search, :by => :sa, :as => 'SA'
          %th= order @search, :by => :profession_name, :as => 'Profession'
          %th Exposition
          %th= order @search, :by => :niveau_name, :as => 'Niveau'
          %th CAT préconisée
          %th Evolution
        = render :partial => @dossiers
    %p
      %a{ :href => "#results" }
        Début de la liste
      |
      %a{ :href => "#top"}
        Remonter
  - else
    %p Aucun résultat

- content_for :footer do
  %p= link_to "Nouveau Dossier", new_dossier_path
